<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Performance Optimization | Wavelet - Business Management Platform</title><meta name=description content="System performance tuning, optimization strategies, and best practices"><link rel=icon type=image/x-icon href=https://www.wavelet.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.wavelet.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.wavelet.net/favicon-32x32.png><link rel=apple-touch-icon sizes=180x180 href=https://www.wavelet.net/apple-touch-icon.png><link rel=manifest href=https://www.wavelet.net/site.webmanifest><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel=stylesheet><link rel=stylesheet href=https://www.wavelet.net/css/custom.css><meta property="og:title" content="Performance Optimization"><meta property="og:description" content="System performance tuning, optimization strategies, and best practices"><meta property="og:type" content="website"><meta property="og:url" content="https://www.wavelet.net/guides/advanced/performance-optimization/"></head><body><header class=corporate-header><div class=container><nav class=nav><div class=nav-logo><a href=https://www.wavelet.net/><img src=https://www.wavelet.net/images/wavelet-logo.png alt="Wavelet - Business Management Platform" height=40></a></div><div class=nav-menu><a href=https://www.wavelet.net/ class=nav-link>Home</a>
<a href=https://www.wavelet.net/about/ class=nav-link>About</a>
<a href=https://www.wavelet.net/solutions/ class=nav-link>Solutions</a>
<a href=https://www.wavelet.net/pricing/ class=nav-link>Pricing</a>
<a href=https://www.wavelet.net/contact/ class=nav-link>Contact</a></div></nav></div></header><main><article class=corporate-page><div class=container><div class=page-content><p><em>Three decades of optimizing ERP systems from 10-user SAP implementations to 10,000-user Oracle deployments. From mainframe performance tuning to cloud optimization, this guide provides proven methodologies for maximum system performance.</em></p><h2>Table of Contents<span class="hx:absolute hx:-mt-20" id=table-of-contents></span>
<a href=#table-of-contents class=subheading-anchor aria-label="Permalink for this section"></a></h2><ol><li><a href=#database-optimization-for-large-datasets>Database Optimization for Large Datasets</a></li><li><a href=#report-performance-tuning>Report Performance Tuning</a></li><li><a href=#batch-processing-best-practices>Batch Processing Best Practices</a></li><li><a href=#archiving-strategies-for-historical-data>Archiving Strategies for Historical Data</a></li></ol><hr><h2>Database Optimization for Large Datasets<span class="hx:absolute hx:-mt-20" id=database-optimization-for-large-datasets></span>
<a href=#database-optimization-for-large-datasets class=subheading-anchor aria-label="Permalink for this section"></a></h2><p>Having optimized databases supporting billions of transactions across multiple ERP platforms, I&rsquo;ve learned that database performance is the foundation of ERP success.</p><h3>Database Architecture and Design<span class="hx:absolute hx:-mt-20" id=database-architecture-and-design></span>
<a href=#database-architecture-and-design class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Optimal Database Configuration for BigLedger</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Database Platform Optimization</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>PostgreSQL Configuration</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Memory Settings</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>shared_buffers</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>% of total RAM</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>effective_cache_size</span>: <span style=color:#ae81ff>75</span><span style=color:#ae81ff>% of total RAM</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>work_mem</span>: <span style=color:#ae81ff>RAM/max_connections</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maintenance_work_mem</span>: <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>2GB</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>Connection Management</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_connections</span>: <span style=color:#ae81ff>Based on concurrent users</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>connection_pooling</span>: <span style=color:#ae81ff>PgBouncer implementation</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>idle_in_transaction_timeout</span>: <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>minutes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>statement_timeout</span>: <span style=color:#ae81ff>60</span> <span style=color:#ae81ff>seconds</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>MySQL Configuration</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>InnoDB Settings</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>innodb_buffer_pool_size</span>: <span style=color:#ae81ff>70-80</span><span style=color:#ae81ff>% of RAM</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>innodb_log_file_size</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>% of buffer pool</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>innodb_flush_log_at_trx_commit</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>innodb_file_per_table</span>: <span style=color:#66d9ef>ON</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>Query Cache</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>query_cache_type</span>: <span style=color:#66d9ef>ON</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>query_cache_size</span>: <span style=color:#ae81ff>256MB-1GB</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>query_cache_limit</span>: <span style=color:#ae81ff>16MB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>SQL Server Configuration</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Memory Management</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_server_memory</span>: <span style=color:#ae81ff>Leave 2-4GB for OS</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>buffer_pool_extension</span>: <span style=color:#ae81ff>SSD storage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>columnstore_archive_data_compression</span>: <span style=color:#66d9ef>ON</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>Parallelism</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_degree_of_parallelism</span>: <span style=color:#ae81ff>CPU cores</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cost_threshold_for_parallelism</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>Indexing Strategy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>fill_factor</span>: <span style=color:#ae81ff>85-90</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>auto_create_statistics</span>: <span style=color:#66d9ef>ON</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>auto_update_statistics</span>: <span style=color:#66d9ef>ON</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><p><strong>Table Design and Indexing Strategy</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Optimal Table Design</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Partitioning Strategy</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Transaction Tables</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Date-Based Partitioning</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Monthly partitions for current year</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Quarterly partitions for historical data</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Automatic partition creation</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Partition pruning optimization</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Range Partitioning Example</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Sales Transaction Table</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_transactions (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id BIGSERIAL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_date DATE NOT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>created_at TIMESTAMP DEFAULT NOW()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) PARTITION BY RANGE (transaction_date);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Monthly Partitions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_2024_01 PARTITION OF sales_transactions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES FROM (&#39;2024-01-01&#39;) TO (&#39;2024-02-01&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_2024_02 PARTITION OF sales_transactions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES FROM (&#39;2024-02-01&#39;) TO (&#39;2024-03-01&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>List Partitioning Example</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Customer Table by Region</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE customers (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id SERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_name VARCHAR(255),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>region VARCHAR(50),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>created_date DATE</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) PARTITION BY LIST (region);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE customers_malaysia PARTITION OF customers</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES IN (&#39;MALAYSIA&#39;, &#39;MY&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE customers_singapore PARTITION OF customers</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES IN (&#39;SINGAPORE&#39;, &#39;SG&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Index Optimization</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Primary Performance Indexes</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Customer lookup optimization</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_customer_name_active </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>customers (customer_name) </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE active = true;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Transaction date range queries</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_sales_date_customer </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>sales_transactions (transaction_date, customer_id);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Inventory movement tracking</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_inventory_product_date </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>inventory_movements (product_id, movement_date)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>INCLUDE (quantity, movement_type);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Composite Index Strategy</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Order processing optimization</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_orders_status_date_customer </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>sales_orders (order_status, order_date, customer_id)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE order_status IN (&#39;PENDING&#39;, &#39;PROCESSING&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Financial reporting indexes</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_gl_account_period </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>general_ledger (account_code, fiscal_period, posting_date)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>INCLUDE (debit_amount, credit_amount);</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Query Optimization Techniques<span class="hx:absolute hx:-mt-20" id=query-optimization-techniques></span>
<a href=#query-optimization-techniques class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Advanced Query Performance Tuning</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Query Optimization Framework</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Execution Plan Analysis</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Key Metrics to Monitor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Query execution time</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Logical reads per query</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Physical reads ratio</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>CPU time consumption</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Memory usage patterns</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Common Performance Issues</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Table Scans</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Problem</span>: <span style=color:#ae81ff>Full table scan on large tables</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Solution</span>: <span style=color:#ae81ff>Proper indexing strategy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Query Example</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Inefficient query (table scan)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT * FROM sales_transactions </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE customer_id = 12345;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized query (index seek)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_sales_customer ON sales_transactions (customer_id);</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT transaction_id, transaction_date, amount </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM sales_transactions </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE customer_id = 12345;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Nested Loops</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Problem</span>: <span style=color:#ae81ff>Inefficient join operations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Solution</span>: <span style=color:#ae81ff>Join optimization and statistics</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Inefficient nested loop</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT c.customer_name, s.total_sales</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM customers c,</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>(SELECT customer_id, SUM(amount) as total_sales</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>GROUP BY customer_id) s</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE c.customer_id = s.customer_id;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized join</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT c.customer_name, COALESCE(s.total_sales, 0)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM customers c</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>LEFT JOIN (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT customer_id, SUM(amount) as total_sales</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE transaction_date &gt;= &#39;2024-01-01&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GROUP BY customer_id</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) s ON c.customer_id = s.customer_id</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE c.active = true;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Query Rewriting Techniques</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Subquery to Join Conversion</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Inefficient subquery</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT product_id, product_name</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM products</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE product_id IN (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT DISTINCT product_id</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE transaction_date &gt;= &#39;2024-01-01&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized join</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT DISTINCT p.product_id, p.product_name</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM products p</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>INNER JOIN sales_transactions s ON p.product_id = s.product_id</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE s.transaction_date &gt;= &#39;2024-01-01&#39;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Conditional Logic Optimization</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Inefficient OR conditions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT * FROM customers</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE region = &#39;MALAYSIA&#39; OR region = &#39;SINGAPORE&#39;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized IN clause</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT * FROM customers</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE region IN (&#39;MALAYSIA&#39;, &#39;SINGAPORE&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Window Function Optimization</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Efficient ranking queries</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_name,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>total_sales,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ROW_NUMBER() OVER (ORDER BY total_sales DESC) as rank</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>c.customer_id,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>c.customer_name,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SUM(s.amount) as total_sales</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM customers c</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>JOIN sales_transactions s ON c.customer_id = s.customer_id</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE s.transaction_date &gt;= &#39;2024-01-01&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GROUP BY c.customer_id, c.customer_name</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) ranked_customers</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE total_sales &gt; 100000;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Database Maintenance and Monitoring<span class="hx:absolute hx:-mt-20" id=database-maintenance-and-monitoring></span>
<a href=#database-maintenance-and-monitoring class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Proactive Database Management</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Maintenance Procedures</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Statistics Management</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Automated Statistics Updates</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>PostgreSQL auto-vacuum configuration</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ALTER SYSTEM SET autovacuum_vacuum_scale_factor = 0.1;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ALTER SYSTEM SET autovacuum_analyze_scale_factor = 0.05;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ALTER SYSTEM SET autovacuum_vacuum_cost_limit = 2000;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>SQL Server statistics update job</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>UPDATE STATISTICS sales_transactions WITH FULLSCAN;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>UPDATE STATISTICS customers WITH SAMPLE 25 PERCENT;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Index Maintenance</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>PostgreSQL index maintenance</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>REINDEX TABLE sales_transactions;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>VACUUM ANALYZE sales_transactions;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>SQL Server index reorganization</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ALTER INDEX idx_sales_date_customer </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>sales_transactions </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>REORGANIZE;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>MySQL index optimization</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>OPTIMIZE TABLE sales_transactions;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Performance Monitoring</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Key Performance Indicators</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Database Response Time</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Average query response</span>: <span style=color:#ae81ff>&lt;100ms</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>95th percentile</span>: <span style=color:#ae81ff>&lt;500ms</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Maximum acceptable</span>: <span style=color:#ae81ff>&lt;2 seconds</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Peak hour performance</span>: <span style=color:#ae81ff>&lt;200ms</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resource Utilization</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>CPU utilization</span>: <span style=color:#ae81ff>&lt;70% average</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Memory usage</span>: <span style=color:#ae81ff>&lt;80% of allocated</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Disk I/O</span>: <span style=color:#ae81ff>&lt;80% capacity</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Network bandwidth</span>: <span style=color:#ae81ff>&lt;60% capacity</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Concurrency Metrics</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Active connections</span>: <span style=color:#ae81ff>Monitor trends</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Lock wait time</span>: <span style=color:#ae81ff>&lt;100ms average</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Deadlock frequency</span>: <span style=color:#ae81ff>&lt;1 per hour</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>Blocking processes</span>: <span style=color:#ae81ff>&lt;5% of queries</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Monitoring Queries</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>PostgreSQL performance monitoring</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>query,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>calls,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>total_time,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>mean_time,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>rows</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM pg_stat_statements</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE mean_time &gt; 1000</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ORDER BY mean_time DESC</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>LIMIT 20;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>SQL Server wait statistics</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>wait_type,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>waiting_tasks_count,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>wait_time_ms,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>max_wait_time_ms,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>signal_wait_time_ms</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM sys.dm_os_wait_stats</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE wait_time_ms &gt; 1000</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ORDER BY wait_time_ms DESC;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>MySQL slow query analysis</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>DIGEST_TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>COUNT_STAR,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>AVG_TIMER_WAIT/1000000 as avg_ms,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>MAX_TIMER_WAIT/1000000 as max_ms</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM performance_schema.events_statements_summary_by_digest</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE AVG_TIMER_WAIT &gt; 1000000000</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ORDER BY AVG_TIMER_WAIT DESC</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>LIMIT 20;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Automated Alerts</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Performance Alert Thresholds</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Database response time alerts</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHEN average_response_time &gt; 500ms FOR 5 minutes</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>THEN send_alert(&#39;Database Performance Degradation&#39;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Resource utilization alerts</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHEN cpu_usage &gt; 80% FOR 10 minutes</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>THEN send_alert(&#39;High CPU Utilization&#39;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Connection pool alerts</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHEN active_connections &gt; 80% of max_connections</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>THEN send_alert(&#39;Connection Pool Nearly Exhausted&#39;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Deadlock alerts</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHEN deadlock_count &gt; 5 IN 1 hour</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>THEN send_alert(&#39;High Deadlock Frequency&#39;)</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><hr><h2>Report Performance Tuning<span class="hx:absolute hx:-mt-20" id=report-performance-tuning></span>
<a href=#report-performance-tuning class=subheading-anchor aria-label="Permalink for this section"></a></h2><p>Report performance directly impacts user productivity and system adoption. Slow reports are the primary complaint in ERP implementations.</p><h3>Report Architecture Optimization<span class="hx:absolute hx:-mt-20" id=report-architecture-optimization></span>
<a href=#report-architecture-optimization class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Efficient Reporting Framework</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Reporting Architecture</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Data Warehouse Approach</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Dimensional Modeling</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Fact Tables</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>sales_fact</span>: <span style=color:#ae81ff>Transaction-level sales data</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>inventory_fact</span>: <span style=color:#ae81ff>Stock movement details</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>financial_fact</span>: <span style=color:#ae81ff>GL transaction details</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>production_fact</span>: <span style=color:#ae81ff>Manufacturing metrics</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Dimension Tables</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>date_dimension</span>: <span style=color:#ae81ff>Complete date hierarchy</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>customer_dimension</span>: <span style=color:#ae81ff>Customer attributes</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>product_dimension</span>: <span style=color:#ae81ff>Product hierarchies</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>geography_dimension</span>: <span style=color:#ae81ff>Location data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Star Schema Example</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Sales fact table</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_fact (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fact_id BIGSERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>date_key INTEGER REFERENCES date_dimension(date_key),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_key INTEGER REFERENCES customer_dimension(customer_key),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>product_key INTEGER REFERENCES product_dimension(product_key),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>geography_key INTEGER REFERENCES geography_dimension(geography_key),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>sales_amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>quantity INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>cost_amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>profit_amount DECIMAL(18,2)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized indexes for reporting</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_sales_fact_date ON sales_fact (date_key);</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_sales_fact_customer ON sales_fact (customer_key);</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_sales_fact_product ON sales_fact (product_key);</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_sales_fact_combo ON sales_fact (date_key, customer_key, product_key);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Materialized Views</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Monthly sales summary</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE MATERIALIZED VIEW monthly_sales_summary AS</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>d.year,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>d.month,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>c.customer_segment,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p.product_category,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SUM(f.sales_amount) as total_sales,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SUM(f.quantity) as total_quantity,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SUM(f.profit_amount) as total_profit,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>COUNT(*) as transaction_count</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM sales_fact f</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>JOIN date_dimension d ON f.date_key = d.date_key</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>JOIN customer_dimension c ON f.customer_key = c.customer_key</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>JOIN product_dimension p ON f.product_key = p.product_key</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>GROUP BY d.year, d.month, c.customer_segment, p.product_category;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Refresh strategy</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION refresh_monthly_summary()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>REFRESH MATERIALIZED VIEW CONCURRENTLY monthly_sales_summary;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Scheduled refresh (daily at 2 AM)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT cron.schedule(&#39;refresh-summary&#39;, &#39;0 2 * * *&#39;, &#39;SELECT refresh_monthly_summary();&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Aggregate Tables</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Pre-calculated daily summaries</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE daily_sales_summary (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>summary_date DATE PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>total_sales DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>total_orders INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>average_order_value DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>top_customer_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>top_product_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>created_at TIMESTAMP DEFAULT NOW()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Automated population</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION populate_daily_summary(p_date DATE)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO daily_sales_summary (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>summary_date, total_sales, total_orders, </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>average_order_value, top_customer_id, top_product_id</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>p_date,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SUM(amount),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>COUNT(*),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AVG(amount),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SELECT customer_id FROM sales_transactions </span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>WHERE DATE(transaction_date) = p_date </span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>GROUP BY customer_id </span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>ORDER BY SUM(amount) DESC LIMIT 1),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SELECT product_id FROM sales_transaction_lines stl</span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>JOIN sales_transactions st ON stl.transaction_id = st.transaction_id</span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>WHERE DATE(st.transaction_date) = p_date </span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>GROUP BY product_id </span>
</span></span><span style=display:flex><span>         <span style=color:#ae81ff>ORDER BY SUM(quantity) DESC LIMIT 1)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE DATE(transaction_date) = p_date</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>CONFLICT (summary_date) DO UPDATE SET</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>total_sales = EXCLUDED.total_sales,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>total_orders = EXCLUDED.total_orders,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>average_order_value = EXCLUDED.average_order_value,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>top_customer_id = EXCLUDED.top_customer_id,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>top_product_id = EXCLUDED.top_product_id;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Report Query Optimization<span class="hx:absolute hx:-mt-20" id=report-query-optimization></span>
<a href=#report-query-optimization class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Advanced Report Query Techniques</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Query Optimization for Reports</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Efficient Aggregation</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized sales report query</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WITH monthly_metrics AS (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>DATE_TRUNC(&#39;month&#39;, transaction_date) as month,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>customer_id,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SUM(amount) as monthly_sales,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>COUNT(*) as transaction_count,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AVG(amount) as avg_transaction</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE transaction_date &gt;= &#39;2024-01-01&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GROUP BY DATE_TRUNC(&#39;month&#39;, transaction_date), customer_id</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>),</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>customer_rankings AS (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>month,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>customer_id,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>monthly_sales,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>RANK() OVER (PARTITION BY month ORDER BY monthly_sales DESC) as sales_rank</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM monthly_metrics</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>c.customer_name,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>cr.month,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>cr.monthly_sales,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>cr.sales_rank,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>mm.transaction_count,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>mm.avg_transaction</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM customer_rankings cr</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>JOIN customers c ON cr.customer_id = c.customer_id</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>JOIN monthly_metrics mm ON cr.customer_id = mm.customer_id </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>AND cr.month = mm.month</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE cr.sales_rank &lt;= 10</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ORDER BY cr.month, cr.sales_rank;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Parallel Processing</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Enable parallel query execution</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SET max_parallel_workers_per_gather = 4;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SET parallel_tuple_cost = 0.1;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SET parallel_setup_cost = 1000;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Large dataset aggregation with parallel processing</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EXPLAIN (ANALYZE, BUFFERS) </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>product_category,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>COUNT(*) as product_count,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SUM(sales_amount) as total_sales,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>AVG(sales_amount) as avg_sales</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM large_sales_fact</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE transaction_date &gt;= &#39;2023-01-01&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>GROUP BY product_category</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>HAVING SUM(sales_amount) &gt; 1000000;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Column Store Optimization</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>PostgreSQL columnar extension for analytics</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE EXTENSION IF NOT EXISTS columnar;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Convert large fact table to columnar format</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT alter_table_set_access_method(&#39;sales_fact&#39;, &#39;columnar&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Compress columnar data</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT compress_chunk(chunk_name) </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM chunk_info </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE table_name = &#39;sales_fact&#39;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Incremental Reporting</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Delta processing for large reports</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE report_processing_log (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>report_name VARCHAR(100),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>last_processed_date TIMESTAMP,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>last_processed_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>processing_status VARCHAR(20)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Incremental data processing function</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION process_incremental_sales_report()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>last_id BIGINT;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>last_date TIMESTAMP;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Get last processed position</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT last_processed_id, last_processed_date</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INTO last_id, last_date</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM report_processing_log</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE report_name = &#39;daily_sales_summary&#39;;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Process new records only</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO daily_sales_aggregate (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>process_date, customer_segment, product_category,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>sales_amount, order_count, profit_margin</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>DATE(s.transaction_date),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>c.customer_segment,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>p.product_category,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SUM(s.amount),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>COUNT(*),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SUM(s.amount) - SUM(s.cost_amount)) / SUM(s.amount) * 100</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM sales_transactions s</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>JOIN customers c ON s.customer_id = c.customer_id</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>JOIN products p ON s.product_id = p.product_id</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE s.transaction_id &gt; last_id</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND s.transaction_date &gt; last_date</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GROUP BY DATE(s.transaction_date), c.customer_segment, p.product_category;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Update processing log</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>UPDATE report_processing_log</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SET last_processed_id = (SELECT MAX(transaction_id) FROM sales_transactions),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>last_processed_date = NOW(),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>processing_status = &#39;COMPLETED&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE report_name = &#39;daily_sales_summary&#39;;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Report Caching and Delivery<span class="hx:absolute hx:-mt-20" id=report-caching-and-delivery></span>
<a href=#report-caching-and-delivery class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Intelligent Report Caching</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Caching Strategy</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Multi-Level Caching</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Database Level Caching</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Query result caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Materialized view caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Prepared statement caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Connection pooling</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Application Level Caching</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Report object caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Parameter-based caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>User session caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Memory-based storage</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>CDN Level Caching</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Static report delivery</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Geographic distribution</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Edge server caching</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Bandwidth optimization</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Cache Implementation</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Redis caching for report results</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>const reportCache = {</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Generate cache key based on report parameters</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>generateKey</span>: <span style=color:#ae81ff>(reportType, parameters) =&gt; {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>const params = JSON.stringify(parameters);</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>return `report:${reportType}:${crypto.createHash(&#39;md5&#39;).update(params).digest(&#39;hex&#39;)}`;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Cache report with TTL</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>set</span>: <span style=color:#ae81ff>async (key, data, ttlSeconds = 3600) =&gt; {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>await redis.setex(key, ttlSeconds, JSON.stringify(data));</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Retrieve cached report</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>get</span>: <span style=color:#ae81ff>async (key) =&gt; {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>const cached = await redis.get(key);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>return cached ? JSON.parse(cached) </span>: <span style=color:#66d9ef>null</span><span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Invalidate cache pattern</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>invalidatePattern</span>: <span style=color:#ae81ff>async (pattern) =&gt; {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>const keys = await redis.keys(pattern);</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>if (keys.length &gt; 0) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>await redis.del(...keys);</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}<span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>// Report generation with caching</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>async function generateSalesReport(parameters) {</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>const cacheKey = reportCache.generateKey(&#39;sales&#39;, parameters);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Check cache first</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>let reportData = await reportCache.get(cacheKey);</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>if (reportData) {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>return { data: reportData, cached: true };</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Generate report if not cached</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>reportData = await executeReportQuery(parameters);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Cache for 1 hour</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>await reportCache.set(cacheKey, reportData, 3600);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>return { data: reportData, cached: false };</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Scheduled Report Generation</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Pre-generate popular reports</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE scheduled_reports (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>report_id SERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>report_name VARCHAR(100),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>report_parameters JSONB,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>schedule_expression VARCHAR(50),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>last_generated TIMESTAMP,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>next_generation TIMESTAMP,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>output_format VARCHAR(20),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>delivery_method VARCHAR(20),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>recipients TEXT[]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Daily executive dashboard</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>INSERT INTO scheduled_reports (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>report_name, report_parameters, schedule_expression,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>output_format, delivery_method, recipients</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) VALUES (</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Executive Dashboard&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;{&#34;period&#34;: &#34;yesterday&#34;, &#34;format&#34;: &#34;summary&#34;}&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0 7 * * *&#39;</span>,  -- <span style=color:#ae81ff>Daily at 7 AM</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;PDF&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;EMAIL&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ARRAY[&#39;ceo@company.com&#39;, &#39;cfo@company.com&#39;]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Monthly financial package</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>INSERT INTO scheduled_reports (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>report_name, report_parameters, schedule_expression,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>output_format, delivery_method, recipients</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) VALUES (</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Monthly Financial Package&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;{&#34;period&#34;: &#34;last_month&#34;, &#34;detail_level&#34;: &#34;full&#34;}&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0 8 1 * *&#39;</span>,  -- <span style=color:#ae81ff>First day of month at 8 AM</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;PDF&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;EMAIL&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ARRAY[&#39;finance-team@company.com&#39;, &#39;board@company.com&#39;]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Report Delivery Optimization</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Asynchronous report generation</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>const reportQueue = new Queue(&#39;report generation&#39;, {</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>redis</span>: <span style=color:#ae81ff>redisConfig,</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>defaultJobOptions</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>removeOnComplete</span>: <span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>removeOnFail</span>: <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>attempts</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>backoff</span>: <span style=color:#e6db74>&#39;exponential&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}<span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>// Add report to processing queue</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>reportQueue.add(&#39;generate-report&#39;, {</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>reportType</span>: <span style=color:#e6db74>&#39;financial-summary&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>parameters</span>: { <span style=color:#f92672>period: &#39;2024-01&#39;, detail</span>: <span style=color:#e6db74>&#39;full&#39;</span> },
</span></span><span style=display:flex><span>    <span style=color:#f92672>requesterId</span>: <span style=color:#e6db74>&#39;user123&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>priority</span>: <span style=color:#e6db74>&#39;high&#39;</span>
</span></span><span style=display:flex><span>}, {
</span></span><span style=display:flex><span>    <span style=color:#f92672>priority</span>: <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>delay</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}<span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>// Process report generation</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>reportQueue.process(&#39;generate-report&#39;, 5, async (job) =&gt; {</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>const { reportType, parameters, requesterId } = job.data;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Update progress</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job.progress(10);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Generate report data</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>const reportData = await generateReportData(reportType, parameters);</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job.progress(60);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Format report</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>const formattedReport = await formatReport(reportData, parameters.format);</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job.progress(90);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>// Deliver report</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>await deliverReport(formattedReport, requesterId);</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job.progress(100);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>return { status: &#39;completed&#39;, reportId: formattedReport.id };</span>
</span></span><span style=display:flex><span>}<span style=color:#ae81ff>);</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><hr><h2>Batch Processing Best Practices<span class="hx:absolute hx:-mt-20" id=batch-processing-best-practices></span>
<a href=#batch-processing-best-practices class=subheading-anchor aria-label="Permalink for this section"></a></h2><p>Efficient batch processing is essential for data-intensive operations like month-end closing, data synchronization, and large-scale calculations.</p><h3>Batch Job Architecture<span class="hx:absolute hx:-mt-20" id=batch-job-architecture></span>
<a href=#batch-job-architecture class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Enterprise Batch Processing Framework</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Batch Processing Architecture</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Job Scheduling Framework</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Cron-based Scheduling</span>:
</span></span><span style=display:flex><span><span style=color:#75715e># Daily data synchronization (2 AM)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span> * * * <span style=color:#ae81ff>/opt/bigledger/scripts/sync_daily_data.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Weekly report generation (Sunday 3 AM)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>3</span> * * <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>/opt/bigledger/scripts/generate_weekly_reports.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Monthly closing procedures (First day 4 AM)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>1</span> * * <span style=color:#ae81ff>/opt/bigledger/scripts/monthly_closing.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Quarterly compliance reports (First day of quarter 5 AM)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>10</span> * <span style=color:#ae81ff>/opt/bigledger/scripts/quarterly_compliance.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Advanced Job Scheduling</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Database-driven job scheduler</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE batch_jobs (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job_id SERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job_name VARCHAR(100) UNIQUE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job_type VARCHAR(50),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>schedule_expression VARCHAR(100),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job_parameters JSONB,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>enabled BOOLEAN DEFAULT true,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>last_run TIMESTAMP,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>next_run TIMESTAMP,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>max_runtime_minutes INTEGER DEFAULT 60,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>retry_count INTEGER DEFAULT 3,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>notification_emails TEXT[],</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>created_at TIMESTAMP DEFAULT NOW()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Job execution log</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE batch_job_executions (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>execution_id BIGSERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job_id INTEGER REFERENCES batch_jobs(job_id),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>start_time TIMESTAMP DEFAULT NOW(),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>end_time TIMESTAMP,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>status VARCHAR(20), -- RUNNING, COMPLETED, FAILED, TIMEOUT</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>records_processed INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>error_message TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>execution_details JSONB</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Example job definitions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>INSERT INTO batch_jobs (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>job_name, job_type, schedule_expression, job_parameters,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>max_runtime_minutes, notification_emails</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) VALUES (</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Daily Customer Synchronization&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;DATA_SYNC&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0 2 * * *&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;{&#34;source&#34;: &#34;CRM&#34;, &#34;target&#34;: &#34;BigLedger&#34;, &#34;chunk_size&#34;: 1000}&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ARRAY[&#39;it-ops@company.com&#39;]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>), (</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Monthly Depreciation Calculation&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;FINANCIAL_CALC&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0 1 1 * *&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;{&#34;calculation_type&#34;: &#34;depreciation&#34;, &#34;period&#34;: &#34;monthly&#34;}&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>120</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ARRAY[&#39;finance@company.com&#39;, &#39;it-ops@company.com&#39;]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Parallel Processing Framework</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Chunk-based processing for large datasets</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION process_large_dataset(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_table_name TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_processing_function TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_chunk_size INTEGER DEFAULT 10000,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_max_parallel INTEGER DEFAULT 4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS TABLE(chunk_id INTEGER, records_processed INTEGER, processing_time INTERVAL) AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>total_records INTEGER;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>chunk_count INTEGER;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>current_chunk INTEGER;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Get total record count</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>EXECUTE format(&#39;SELECT COUNT(*) FROM %I WHERE processing_status = &#39;&#39;PENDING&#39;&#39;&#39;, p_table_name)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INTO total_records;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>chunk_count := CEIL(total_records::FLOAT / p_chunk_size);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Process chunks in parallel</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FOR current_chunk IN 1..chunk_count LOOP</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Return chunk processing info</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>RETURN QUERY</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT current_chunk, p_chunk_size, INTERVAL &#39;0 seconds&#39;;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>END LOOP;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-- Example</span>: <span style=color:#ae81ff>Parallel customer data processing</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT * FROM process_large_dataset(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;customer_updates&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;update_customer_credit_limits&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>5000</span>,  -- <span style=color:#ae81ff>5000</span> <span style=color:#ae81ff>records per chunk</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>6</span>      -- <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>parallel processes</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Error Handling and Recovery</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Robust error handling framework</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE batch_job_errors (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>error_id BIGSERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>execution_id BIGINT REFERENCES batch_job_executions(execution_id),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>error_time TIMESTAMP DEFAULT NOW(),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>error_type VARCHAR(50),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>error_message TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>stack_trace TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>recovery_action TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>resolved BOOLEAN DEFAULT false</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Checkpoint and restart mechanism</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE batch_job_checkpoints (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>checkpoint_id BIGSERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>execution_id BIGINT REFERENCES batch_job_executions(execution_id),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>checkpoint_name VARCHAR(100),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>checkpoint_data JSONB,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>created_at TIMESTAMP DEFAULT NOW()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Example checkpoint function</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION save_checkpoint(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_execution_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_checkpoint_name TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_data JSONB</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO batch_job_checkpoints (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>execution_id, checkpoint_name, checkpoint_data</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>) VALUES (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>p_execution_id, p_checkpoint_name, p_data</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Recovery function</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION recover_from_checkpoint(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_execution_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_checkpoint_name TEXT</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS JSONB AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>checkpoint_data JSONB;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT checkpoint_data INTO checkpoint_data</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM batch_job_checkpoints</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE execution_id = p_execution_id</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND checkpoint_name = p_checkpoint_name</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ORDER BY created_at DESC</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>LIMIT 1;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>RETURN checkpoint_data;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Performance Optimization for Batch Jobs<span class="hx:absolute hx:-mt-20" id=performance-optimization-for-batch-jobs></span>
<a href=#performance-optimization-for-batch-jobs class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>High-Performance Batch Processing</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Memory Management</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Streaming Data Processing</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Process large datasets without loading all into memory</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION stream_process_transactions()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_cursor CURSOR FOR</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT transaction_id, customer_id, amount, transaction_date</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>WHERE processing_status = &#39;PENDING&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>ORDER BY transaction_id;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>current_record RECORD;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>batch_count INTEGER := 0;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>commit_interval INTEGER := 1000;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FOR current_record IN transaction_cursor LOOP</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Process individual record</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>PERFORM process_transaction_record(current_record);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>batch_count := batch_count + 1;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Commit periodically to free locks</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>IF batch_count % commit_interval = 0 THEN</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>COMMIT;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>RAISE NOTICE &#39;Processed % records&#39;, batch_count;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>END IF;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>END LOOP;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>RAISE NOTICE &#39;Total records processed</span>: <span style=color:#ae81ff>%&#39;, batch_count;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Bulk Operations</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Efficient bulk insert operations</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION bulk_insert_customer_updates(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_data JSONB[]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS INTEGER AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>inserted_count INTEGER;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Use COPY for maximum performance</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>CREATE TEMP TABLE temp_customer_updates (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>customer_id INTEGER,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>customer_name VARCHAR(255),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>credit_limit DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>last_updated TIMESTAMP DEFAULT NOW()</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>) ON COMMIT DROP;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Bulk insert using COPY</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>COPY temp_customer_updates (customer_id, customer_name, credit_limit)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM PROGRAM &#39;echo &#39;&#39;&#39; || array_to_string(p_data, E&#39;\n&#39;) || &#39;&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WITH (FORMAT csv, DELIMITER &#39;,&#39;);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Merge with main table</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO customers (customer_id, customer_name, credit_limit, last_updated)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT customer_id, customer_name, credit_limit, last_updated</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM temp_customer_updates</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>CONFLICT (customer_id) DO UPDATE SET</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>customer_name = EXCLUDED.customer_name,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>credit_limit = EXCLUDED.credit_limit,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>last_updated = EXCLUDED.last_updated;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GET DIAGNOSTICS inserted_count = ROW_COUNT;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>RETURN inserted_count;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Database Connection Management</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Connection pooling for batch jobs</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>const batchJobPool = new Pool({</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>host</span>: <span style=color:#e6db74>&#39;database-server&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>database</span>: <span style=color:#e6db74>&#39;bigledger&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#e6db74>&#39;batch_user&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#ae81ff>process.env.BATCH_DB_PASSWORD,</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>max</span>: <span style=color:#ae81ff>10</span>,              <span style=color:#ae81ff>// Maximum pool size</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>min</span>: <span style=color:#ae81ff>2</span>,               <span style=color:#ae81ff>// Minimum pool size</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>acquireTimeoutMillis</span>: <span style=color:#ae81ff>30000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>createTimeoutMillis</span>: <span style=color:#ae81ff>30000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>destroyTimeoutMillis</span>: <span style=color:#ae81ff>5000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>idleTimeoutMillis</span>: <span style=color:#ae81ff>30000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>reapIntervalMillis</span>: <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>createRetryIntervalMillis</span>: <span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>}<span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>// Batch processing with connection management</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>async function processBatchJob(jobDefinition) {</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>const client = await batchJobPool.connect();</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>try {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>await client.query(&#39;BEGIN&#39;);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>const batchSize = jobDefinition.parameters.batchSize || 1000;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>let offset = 0;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>let processedCount = 0;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>while (true) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>const result = await client.query(`</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>SELECT * FROM ${jobDefinition.sourceTable}</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>WHERE processing_status = &#39;PENDING&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>ORDER BY id</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>LIMIT $1 OFFSET $2</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>`, [batchSize, offset]);</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>if (result.rows.length === 0) break;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>// Process batch</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>for (const row of result.rows) {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>await processRecord(client, row);</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>processedCount++;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>// Commit batch</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>await client.query(&#39;COMMIT&#39;);</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>await client.query(&#39;BEGIN&#39;);</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>offset += batchSize;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>// Progress reporting</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>console.log(`Processed ${processedCount} records`);</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>await client.query(&#39;COMMIT&#39;);</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>return { status: &#39;completed&#39;, recordsProcessed: processedCount };</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    } <span style=color:#ae81ff>catch (error) {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>await client.query(&#39;ROLLBACK&#39;);</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>throw error;</span>
</span></span><span style=display:flex><span>    } <span style=color:#ae81ff>finally {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>client.release();</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resource Monitoring</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Monitor batch job resource usage</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE batch_job_metrics (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>metric_id BIGSERIAL PRIMARY KEY,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>execution_id BIGINT REFERENCES batch_job_executions(execution_id),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>metric_time TIMESTAMP DEFAULT NOW(),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>cpu_usage_percent DECIMAL(5,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>memory_usage_mb INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>disk_io_mb INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>network_io_mb INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>active_connections INTEGER</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Automated metric collection</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION collect_batch_metrics(p_execution_id BIGINT)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO batch_job_metrics (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>execution_id, cpu_usage_percent, memory_usage_mb,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>disk_io_mb, active_connections</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>p_execution_id,</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>CPU usage from system stats</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SELECT cpu_user + cpu_system FROM pg_stat_bgwriter) as cpu_usage,</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Memory usage estimation</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SELECT setting::INTEGER / 1024 FROM pg_settings WHERE name = &#39;shared_buffers&#39;) as memory_mb,</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Disk I/O from pg_stat_database</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SELECT blks_read + blks_hit FROM pg_stat_database WHERE datname = current_database()) / 1024 as disk_io,</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Active connections</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>(SELECT count(*) FROM pg_stat_activity WHERE state = &#39;active&#39;) as connections;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><hr><h2>Archiving Strategies for Historical Data<span class="hx:absolute hx:-mt-20" id=archiving-strategies-for-historical-data></span>
<a href=#archiving-strategies-for-historical-data class=subheading-anchor aria-label="Permalink for this section"></a></h2><p>Effective data archiving maintains system performance while preserving historical information for compliance and analysis.</p><h3>Data Lifecycle Management<span class="hx:absolute hx:-mt-20" id=data-lifecycle-management></span>
<a href=#data-lifecycle-management class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Comprehensive Archiving Framework</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Data Retention Policies</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Regulatory Requirements</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Financial Data (7 years - Malaysian Companies Act)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>General ledger transactions</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Customer and vendor invoices</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Bank statements and reconciliations</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Tax returns and supporting documents</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Audit trails and approvals</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Employment Records (12 years - Employment Act)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Employee personal records</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Payroll and benefits data</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Time and attendance records</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Performance evaluations</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Disciplinary records</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Operational Data (3-5 years - Business needs)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Sales transactions and orders</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Purchase orders and receipts</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Inventory movements</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Production records</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Customer communications</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>System Data (1-2 years - Performance)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Application logs</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>System metrics</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>User activity logs</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Error logs and traces</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Performance monitoring data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Archiving Strategy by Data Type</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Hot Data (Active - 0-12 months)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Full system performance</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Real-time access required</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Complete indexing</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Backup and replication</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Regular maintenance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Warm Data (Reference - 1-3 years)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Reduced performance acceptable</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Occasional access required</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Selective indexing</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Compressed storage</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Periodic maintenance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Cold Data (Archive - 3+ years)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Minimal performance requirements</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Rare access required</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Basic indexing only</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>High compression</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Minimal maintenance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Frozen Data (Compliance - 7+ years)</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Compliance access only</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Immutable storage</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Legal hold capability</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Offline storage acceptable</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Audit trail required</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Archive Implementation Strategy<span class="hx:absolute hx:-mt-20" id=archive-implementation-strategy></span>
<a href=#archive-implementation-strategy class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Technical Archiving Framework</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Table Partitioning for Archiving</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Date-Based Partitioning</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Sales transactions with automatic archiving</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_transactions (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id BIGSERIAL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_date DATE NOT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>created_at TIMESTAMP DEFAULT NOW()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) PARTITION BY RANGE (transaction_date);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Current year partitions (Hot data)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_2024_q1 PARTITION OF sales_transactions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES FROM (&#39;2024-01-01&#39;) TO (&#39;2024-04-01&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_2024_q2 PARTITION OF sales_transactions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES FROM (&#39;2024-04-01&#39;) TO (&#39;2024-07-01&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Previous year partitions (Warm data)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_2023_q1 PARTITION OF sales_transactions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOR VALUES FROM (&#39;2023-01-01&#39;) TO (&#39;2023-04-01&#39;)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WITH (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>toast_tuple_target = 8160,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fillfactor = 85,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>parallel_workers = 2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Archive table structure (Cold data)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE sales_transactions_archive (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_date DATE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>archive_date TIMESTAMP DEFAULT NOW(),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>original_table VARCHAR(50)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Automated archiving procedure</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION archive_old_partitions()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>partition_name TEXT;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>archive_date DATE := CURRENT_DATE - INTERVAL &#39;3 years&#39;;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Find partitions older than 3 years</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FOR partition_name IN</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT schemaname||&#39;.&#39;||tablename</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>FROM pg_tables</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>WHERE tablename LIKE &#39;sales_%&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND tablename &lt; &#39;sales_&#39; || EXTRACT(YEAR FROM archive_date)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>LOOP</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Move data to archive table</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>EXECUTE format(&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>INSERT INTO sales_transactions_archive </span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>SELECT *, NOW(), %L FROM %s&#39;,</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>partition_name, partition_name</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Drop old partition</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>EXECUTE format(&#39;DROP TABLE %s&#39;, partition_name);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#f92672>RAISE NOTICE &#39;Archived and dropped partition</span>: <span style=color:#ae81ff>%&#39;, partition_name;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>END LOOP;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Schedule monthly archiving</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT cron.schedule(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;monthly-archiving&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0 2 1 * *&#39;</span>,  -- <span style=color:#ae81ff>First day of month at 2 AM</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;SELECT archive_old_partitions();&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Data Compression Strategies</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Enable compression on archive tables</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>ALTER TABLE sales_transactions_archive </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SET (toast_compression = &#39;lz4&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Column-specific compression</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE TABLE financial_transactions_archive (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>account_code VARCHAR(20),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>description TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>document_data BYTEA,  -- Compressed documents</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>archive_metadata JSONB</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) WITH (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>compression = &#39;lz4&#39;,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>compress_level = 6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Automated compression function</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION compress_archive_data()</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS void AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>table_name TEXT;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>compression_ratio DECIMAL;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FOR table_name IN</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT tablename </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>FROM pg_tables </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>WHERE tablename LIKE &#39;%_archive&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>LOOP</span>
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Apply compression</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>EXECUTE format(&#39;VACUUM FULL %I&#39;, table_name);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        -- <span style=color:#ae81ff>Report compression ratio</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>pg_total_relation_size(table_name::regclass)::DECIMAL / </span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>pg_relation_size(table_name::regclass) </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>INTO compression_ratio;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#f92672>RAISE NOTICE &#39;Compressed %</span>: <span style=color:#ae81ff>ratio %.2f:1&#39;, table_name, compression_ratio;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>END LOOP;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>External Storage Integration</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Archive to external storage (S3, Azure Blob, etc.)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE EXTENSION IF NOT EXISTS aws_s3 CASCADE;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Function to export archive data to S3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION export_to_s3(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_table_name TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_date_filter DATE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_s3_bucket TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_s3_key TEXT</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS BOOLEAN AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>export_query TEXT;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>export_result BOOLEAN;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>export_query := format(&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT aws_s3.query_export_to_s3(</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;&#39;</span><span style=color:#ae81ff>SELECT * FROM %I WHERE archive_date &gt;= %L&#39;&#39;,</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>aws_commons.create_s3_uri(%L, %L, &#39;&#39;us-east-1&#39;&#39;),</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>options := &#39;&#39;format csv, header true&#39;&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>)&#39;, p_table_name, p_date_filter, p_s3_bucket, p_s3_key);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>EXECUTE export_query INTO export_result;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>RETURN export_result;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Schedule S3 export</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT cron.schedule(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;quarterly-s3-export&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0 3 1 1,4,7,10 *&#39;</span>,  -- <span style=color:#ae81ff>Quarterly at 3 AM</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;SELECT export_to_s3(&#39;&#39;financial_transactions_archive&#39;&#39;, 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        CURRENT_DATE - INTERVAL &#39;&#39;1 year&#39;&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        &#39;&#39;company-archive-bucket&#39;&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        &#39;&#39;financial/&#39;&#39; || EXTRACT(YEAR FROM CURRENT_DATE) || &#39;&#39;/q&#39;&#39; || EXTRACT(QUARTER FROM CURRENT_DATE) || &#39;&#39;.csv&#39;&#39;);&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>);</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><h3>Archive Access and Retrieval<span class="hx:absolute hx:-mt-20" id=archive-access-and-retrieval></span>
<a href=#archive-access-and-retrieval class=subheading-anchor aria-label="Permalink for this section"></a></h3><p><strong>Efficient Archive Query Framework</strong></p><div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"><div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Archive Query Optimization</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>Federated Query System</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Create foreign data wrapper for archive</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE EXTENSION IF NOT EXISTS postgres_fdw;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Connect to archive database</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE SERVER archive_server</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FOREIGN DATA WRAPPER postgres_fdw</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>OPTIONS (host &#39;archive-db-server&#39;, port &#39;5432&#39;, dbname &#39;bigledger_archive&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>User mapping for archive access</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE USER MAPPING FOR bigledger_user</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SERVER archive_server</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>OPTIONS (user &#39;archive_reader&#39;, password &#39;secure_password&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Foreign table for archived data</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE FOREIGN TABLE sales_transactions_archive_remote (</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_date DATE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>archive_date TIMESTAMP</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SERVER archive_server</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>OPTIONS (schema_name &#39;public&#39;, table_name &#39;sales_transactions_archive&#39;);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Unified view combining current and archived data</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE VIEW sales_transactions_complete AS</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id, transaction_date, customer_id, amount,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;CURRENT&#39;</span> <span style=color:#ae81ff>as data_source</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM sales_transactions</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE transaction_date &gt;= CURRENT_DATE - INTERVAL &#39;3 years&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>UNION ALL</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id, transaction_date, customer_id, amount,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;ARCHIVE&#39;</span> <span style=color:#ae81ff>as data_source</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>FROM sales_transactions_archive_remote</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE transaction_date &lt; CURRENT_DATE - INTERVAL &#39;3 years&#39;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Archive Search Optimization</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Create search indexes on archive tables</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_archive_customer_date </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>sales_transactions_archive (customer_id, transaction_date);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_archive_amount_range </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>sales_transactions_archive (amount)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WHERE amount &gt; 10000;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Full-text search for archived documents</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE INDEX idx_archive_description_fts </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>financial_transactions_archive </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>USING gin(to_tsvector(&#39;english&#39;, description));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Optimized archive search function</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION search_archived_transactions(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_customer_id INTEGER DEFAULT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_date_from DATE DEFAULT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_date_to DATE DEFAULT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_amount_min DECIMAL DEFAULT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_amount_max DECIMAL DEFAULT NULL,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_description TEXT DEFAULT NULL</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS TABLE(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_id BIGINT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>transaction_date DATE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>customer_id INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>amount DECIMAL(18,2),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>description TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>data_source TEXT</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>RETURN QUERY</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>t.transaction_id,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>t.transaction_date,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>t.customer_id,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>t.amount,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>COALESCE(t.description, &#39;&#39;) as description,</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;ARCHIVE&#39;</span> <span style=color:#ae81ff>as data_source</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>FROM sales_transactions_archive t</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>WHERE (p_customer_id IS NULL OR t.customer_id = p_customer_id)</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND (p_date_from IS NULL OR t.transaction_date &gt;= p_date_from)</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND (p_date_to IS NULL OR t.transaction_date &lt;= p_date_to)</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND (p_amount_min IS NULL OR t.amount &gt;= p_amount_min)</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND (p_amount_max IS NULL OR t.amount &lt;= p_amount_max)</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>AND (p_description IS NULL OR t.description ILIKE &#39;%&#39; || p_description || &#39;%&#39;)</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>ORDER BY t.transaction_date DESC</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>LIMIT 1000;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Data Recovery Procedures</span>:
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Emergency data recovery from archive</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION restore_from_archive(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_transaction_ids BIGINT[],</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_target_table TEXT DEFAULT &#39;sales_transactions&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS INTEGER AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>restored_count INTEGER;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Restore specific transactions from archive</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>EXECUTE format(&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>INSERT INTO %I (transaction_id, transaction_date, customer_id, amount)</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT transaction_id, transaction_date, customer_id, amount</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>FROM sales_transactions_archive</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>WHERE transaction_id = ANY($1)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ON</span> <span style=color:#ae81ff>CONFLICT (transaction_id) DO NOTHING&#39;,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>p_target_table</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>) USING p_transaction_ids;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GET DIAGNOSTICS restored_count = ROW_COUNT;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Log restoration activity</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO archive_access_log (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>access_type, target_table, record_count, </span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>access_user, access_time</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>) VALUES (</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;RESTORE&#39;</span>, <span style=color:#ae81ff>p_target_table, restored_count,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>current_user, NOW()</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>RETURN restored_count;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- <span style=color:#ae81ff>Bulk data restoration for specific date range</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>CREATE OR REPLACE FUNCTION restore_date_range(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_date_from DATE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_date_to DATE,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p_verification_required BOOLEAN DEFAULT true</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RETURNS TABLE(</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>status TEXT,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>records_restored INTEGER,</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>verification_passed BOOLEAN</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>) AS $$</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>DECLARE</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>restore_count INTEGER;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>verification_result BOOLEAN := true;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BEGIN</span>
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Restore data from archive</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>INSERT INTO sales_transactions_temp (</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT * FROM sales_transactions_archive</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>WHERE transaction_date BETWEEN p_date_from AND p_date_to</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>GET DIAGNOSTICS restore_count = ROW_COUNT;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    -- <span style=color:#ae81ff>Verification if requested</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>IF p_verification_required THEN</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>SELECT COUNT(*) = restore_count INTO verification_result</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>FROM sales_transactions_temp</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>WHERE transaction_date BETWEEN p_date_from AND p_date_to;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>END IF;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>RETURN QUERY SELECT </span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;COMPLETED&#39;</span>::<span style=color:#ae81ff>TEXT,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>restore_count,</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>verification_result;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>END;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$$ LANGUAGE plpgsql;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"><button class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="Copy code"><div class="copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"></div><div class="success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"></div></button></div></div><p>This comprehensive performance optimization guide provides the foundation for maintaining high-performance BigLedger implementations at enterprise scale. The key to success lies in proactive monitoring, intelligent caching, efficient batch processing, and strategic data archiving.</p><p>Each section includes practical implementation guidance based on three decades of experience optimizing ERP systems across diverse environments. The emphasis is on creating sustainable performance that scales with business growth while maintaining data integrity and compliance requirements.</p></div></div></article></main><footer class=corporate-footer><div class=container><div class=footer-grid><div class=footer-column><img src=https://www.wavelet.net/images/wavelet-logo.png alt="Wavelet - Business Management Platform" height=32 style=margin-bottom:16px><p>Complete Business Management Platform - ERP, POS, E-Commerce & More</p></div><div class=footer-column><h4>Product</h4><ul><li><a href=https://www.wavelet.net/solutions>Solutions</a></li><li><a href=https://www.wavelet.net/pricing>Pricing</a></li></ul></div><div class=footer-column><h4>Company</h4><ul><li><a href=https://www.wavelet.net/about>About</a></li><li><a href=https://www.wavelet.net/contact>Contact</a></li></ul></div><div class=footer-column><h4>Connect</h4><ul></ul></div></div><div class=footer-bottom><p>&copy; 2025 Wavelet Solutions. All rights reserved.</p></div></div></footer></body></html>